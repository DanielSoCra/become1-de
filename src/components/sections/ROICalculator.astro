---
const base = import.meta.env.BASE_URL;
---

<section id="roi-calculator" class="bg-[#1A6B4A] py-24 section-animate overflow-hidden relative">
  <!-- Background decoration -->
  <div class="absolute inset-0 pointer-events-none">
    <div class="absolute top-0 right-0 w-96 h-96 bg-white/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
    <div class="absolute bottom-0 left-0 w-96 h-96 bg-black/10 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2"></div>
  </div>

  <div class="container mx-auto px-6 max-w-5xl relative z-10">
    <div class="text-center mb-12">
      <p class="text-[#4A9B7A] font-semibold text-sm uppercase tracking-widest mb-3">ROI-RECHNER</p>
      <h2 class="text-3xl md:text-[40px] font-extrabold text-white leading-tight mb-4">
        Berechne dein Sparpotenzial
      </h2>
      <p class="text-white/70 text-lg max-w-2xl mx-auto">
        Finde heraus, wie viel dein Unternehmen durch steuerfreie Benefits im Vergleich zu einer klassischen Gehaltserhöhung spart.
      </p>
    </div>

    <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-8 md:p-10 border border-white/10">
      <!-- Sliders -->
      <div class="grid md:grid-cols-2 gap-8 mb-10">
        <div>
          <label for="employees" class="block text-sm font-semibold text-white mb-3">
            Anzahl Mitarbeiter: <span id="employees-value" class="text-[#F5A623] text-lg font-extrabold">50</span>
          </label>
          <input
            type="range"
            id="employees"
            min="1"
            max="500"
            value="50"
            class="w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer accent-[#F5A623]"
          />
          <div class="flex justify-between text-xs text-white/40 mt-1.5">
            <span>1 MA</span>
            <span>500 MA</span>
          </div>
        </div>

        <div>
          <label for="budget" class="block text-sm font-semibold text-white mb-3">
            Monatliches Budget / Mitarbeiter: <span id="budget-value" class="text-[#F5A623] text-lg font-extrabold">50 €</span>
          </label>
          <input
            type="range"
            id="budget"
            min="10"
            max="200"
            value="50"
            step="5"
            class="w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer accent-[#F5A623]"
          />
          <div class="flex justify-between text-xs text-white/40 mt-1.5">
            <span>10 €</span>
            <span>200 €</span>
          </div>
        </div>
      </div>

      <!-- Visual comparison -->
      <div class="bg-white/5 rounded-xl p-6 mb-8 border border-white/10">
        <p class="text-sm font-semibold text-white/60 mb-4 text-center uppercase tracking-wider">Vergleich: Gehaltserhöhung vs. steuerfreier Benefit</p>
        <div class="space-y-4">
          <!-- Gross salary route -->
          <div>
            <div class="flex justify-between text-xs text-white/60 mb-1.5">
              <span>Klassische Gehaltserhöhung (Arbeitgeberkosten)</span>
              <span id="gross-cost" class="font-bold text-white/80">85 €</span>
            </div>
            <div class="h-3 bg-white/10 rounded-full overflow-hidden">
              <div id="gross-bar" class="h-full bg-red-400/60 rounded-full transition-all duration-500" style="width: 100%"></div>
            </div>
          </div>
          <!-- Benefit route -->
          <div>
            <div class="flex justify-between text-xs text-white/60 mb-1.5">
              <span>Steuerfreier Benefit (Arbeitgeberkosten)</span>
              <span id="benefit-cost" class="font-bold text-[#F5A623]">50 €</span>
            </div>
            <div class="h-3 bg-white/10 rounded-full overflow-hidden">
              <div id="benefit-bar" class="h-full bg-[#F5A623] rounded-full transition-all duration-500" style="width: 59%"></div>
            </div>
          </div>
        </div>
        <p id="savings-label" class="text-center text-sm text-[#4A9B7A] font-semibold mt-4">
          → Du sparst <span id="savings-pct" class="text-white font-extrabold">41%</span> der Kosten vs. Gehaltserhöhung
        </p>
      </div>

      <!-- Results grid -->
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 border-t border-white/20 pt-8">
        <div class="text-center">
          <p class="text-xs text-white/50 mb-2 uppercase tracking-wider">Netto-Vorteil / MA / Monat</p>
          <p id="net-benefit" class="text-4xl font-extrabold text-[#F5A623]">50 €</p>
          <p class="text-xs text-white/40 mt-1">steuerfrei & sozialabgabenfrei</p>
        </div>
        <div class="text-center">
          <p class="text-xs text-white/50 mb-2 uppercase tracking-wider">Ersparnis Arbeitgeber / Jahr</p>
          <p id="employer-savings" class="text-4xl font-extrabold text-white">4.200 €</p>
          <p class="text-xs text-white/40 mt-1">vs. Gehaltserhöhung</p>
        </div>
        <div class="text-center">
          <p class="text-xs text-white/50 mb-2 uppercase tracking-wider">Gesamtvorteil / Jahr</p>
          <p id="total-benefit" class="text-4xl font-extrabold text-[#4A9B7A]">33.000 €</p>
          <p class="text-xs text-white/40 mt-1">für dein Unternehmen</p>
        </div>
      </div>

      <p class="text-xs text-white/30 mt-6 text-center">
        * Berechnung basiert auf einem durchschnittlichen Steuersatz von 30% und Sozialabgaben von 20%. Individuelle Ergebnisse können abweichen.
      </p>
    </div>

    <div class="mt-8 text-center">
      <a href={`${base}demo/`} class="btn-primary text-base py-4 px-10">
        Jetzt Demo vereinbaren & mehr sparen →
      </a>
    </div>
  </div>
</section>

<script>
  const employeesSlider = document.getElementById('employees') as HTMLInputElement;
  const budgetSlider = document.getElementById('budget') as HTMLInputElement;
  const employeesValue = document.getElementById('employees-value');
  const budgetValue = document.getElementById('budget-value');
  const netBenefit = document.getElementById('net-benefit');
  const employerSavings = document.getElementById('employer-savings');
  const totalBenefit = document.getElementById('total-benefit');
  const grossCost = document.getElementById('gross-cost');
  const benefitCost = document.getElementById('benefit-cost');
  const grossBar = document.getElementById('gross-bar') as HTMLElement;
  const benefitBar = document.getElementById('benefit-bar') as HTMLElement;
  const savingsPct = document.getElementById('savings-pct');

  function updateCalculator() {
    const employees = parseInt(employeesSlider?.value || '50');
    const budget = parseInt(budgetSlider?.value || '50');

    // Gross salary equivalent: to give budget€ net, employer needs budget/0.7 gross
    // Plus employer social contributions (~20% on gross)
    const grossEquivalent = Math.round(budget / 0.7 * 1.2);
    const benefitCostVal = budget; // benefit costs exactly budget€ to employer
    const savingsPctVal = Math.round((1 - benefitCostVal / grossEquivalent) * 100);
    const barPct = Math.round((benefitCostVal / grossEquivalent) * 100);

    const employerSavingsPerYear = Math.round((grossEquivalent - benefitCostVal) * 12 * employees);
    const totalAnnualBenefit = budget * employees * 12;

    if (employeesValue) employeesValue.textContent = employees.toString();
    if (budgetValue) budgetValue.textContent = `${budget} €`;
    if (netBenefit) netBenefit.textContent = `${budget} €`;
    if (grossCost) grossCost.textContent = `${grossEquivalent} €`;
    if (benefitCost) benefitCost.textContent = `${benefitCostVal} €`;
    if (grossBar) grossBar.style.width = '100%';
    if (benefitBar) benefitBar.style.width = `${barPct}%`;
    if (savingsPct) savingsPct.textContent = `${savingsPctVal}%`;
    if (employerSavings) employerSavings.textContent = `${employerSavingsPerYear.toLocaleString('de-DE')} €`;
    if (totalBenefit) totalBenefit.textContent = `${totalAnnualBenefit.toLocaleString('de-DE')} €`;
  }

  employeesSlider?.addEventListener('input', updateCalculator);
  budgetSlider?.addEventListener('input', updateCalculator);
  updateCalculator();
</script>
